<?php

namespace Database\Seeders;

use App\Enum\GroupPremission;
use App\Models\Group;
use App\Models\News;
use App\Models\Service;
use App\Models\User;
// use Illuminate\Database\Console\Seeds\WithoutModelEvents;
use Illuminate\Database\Seeder;

class DatabaseSeeder extends Seeder
{
    /**
     * Seed the application's database.
     */
    public function run(): void
    {
        $this->initUserAndGroups();

        if(env('APP_DEBUG')) {
            $news = [
                [
                    'title' => 'Новая функция в нашем приложении',
                    'description' => 'Мы рады сообщить о запуске новой функции, которая улучшит пользовательский опыт.',
                    'filepath' => 'uploads/news/new_feature.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Обновление безопасности',
                    'description' => 'Выпущено обновление, которое устраняет уязвимости в системе безопасности.',
                    'filepath' => 'uploads/news/security_update.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Событие месяца',
                    'description' => 'Присоединяйтесь к нам на нашем месячном событии, где мы обсудим последние новости и тренды.',
                    'filepath' => 'uploads/news/monthly_event.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Партнёрство с новой компанией',
                    'description' => 'Мы рады объявить о нашем новом партнёрстве с ведущей компанией в отрасли.',
                    'filepath' => 'uploads/news/partnership.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Запуск нового продукта',
                    'description' => 'С гордостью представляем наш новый продукт, который изменит правила игры.',
                    'filepath' => 'uploads/news/new_product.jpg',
                    'userId' => 1,
                ],
            ];
            $services = [
                [
                    'title' => 'Физическая охрана объектов',
                    'price' => 80000,
                    'description' => 'Профессиональная физическая охрана офисов, складов, торговых центров и жилых комплексов обеспечивает надежную защиту имущества и безопасность сотрудников. Наши квалифицированные специалисты применяют современные методы контроля доступа, патрулирования и предотвращения противоправных действий. Мы адаптируем наши решения к специфике вашего объекта, обеспечивая эффективное реагирование на любые угрозы и минимизацию рисков.',
                    'filepath' => 'uploads/services/physical_security.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Вооруженное сопровождение грузов',
                    'price' => 400000,
                    'description' => 'Обеспечение безопасности при транспортировке ценных или опасных грузов с применением вооруженного и невооруженного сопровождения. Наши специалисты тщательно планируют маршруты, осуществляют контроль за грузом на всем пути следования и взаимодействуют с правоохранительными органами при необходимости. Это гарантирует сохранность вашего имущества и минимизирует риски краж и нападений во время перевозки.',
                    'filepath' => 'uploads/services/armed_escort.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Круглосуточный патруль',
                    'price' => 100000,
                    'description' => 'Круглосуточный патруль и видеонаблюдение обеспечивают постоянный контроль за территорией вашего объекта. Наша команда профессионалов использует современные технические средства, систему охранной сигнализации и интеллектуальный анализ данных для своевременного выявления и предотвращения угроз. Мы предлагаем оперативное реагирование на инциденты, что повышает уровень защиты и спокойствие наших клиентов.',
                    'filepath' => 'uploads/services/patrol.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Персональная защита',
                    'price' => 350000,
                    'description' => 'Персональная охрана и телохранители для VIP-персон и публичных лиц обеспечивают высокий уровень безопасности на любом мероприятии или в повседневной жизни. Мы тщательно подбираем персонал, учитывая особенности клиента и потенциальные угрозы, применяя лучшие практики охраны. Наша цель — создание комфортной и безопасной среды, чтобы вы могли сосредоточиться на своих задачах и не беспокоиться о рисках.',
                    'filepath' => 'uploads/services/personal_protection.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Безопасность на мероприятиях',
                    'price' => 10700,
                    'description' => 'Организация комплексной безопасности на конференциях, презентациях и частных вечеринках. Мы разрабатываем индивидуальные планы охраны с учетом масштаба и специфики мероприятия, обеспечиваем контроль доступа, видеонаблюдение и взаимодействие с экстренными службами. Наши специалисты гарантируют безопасность гостей, персонала и имущества, предотвращая возможные инциденты и создавая атмосферу комфорта.',
                    'filepath' => 'uploads/services/event_security.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Кибербезопасность',
                    'price' => 160900,
                    'description' => 'Комплексный аудит IT-инфраструктуры вашей организации на наличие уязвимостей, разработка и внедрение эффективных мер защиты данных. Мы анализируем текущие системы защиты, оцениваем риски внешних и внутренних угроз, внедряем средства предотвращения DDoS-атак, шифрования и контроля доступа. Наша команда помогает защитить конфиденциальную информацию и обеспечить бесперебойную работу вашего бизнеса в цифровом пространстве.',
                    'filepath' => 'uploads/services/cyber_security.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Мониторинг темного интернета',
                    'price' => 10500,
                    'description' => 'Профессиональный мониторинг темного интернета (dark web) для выявления утечек информации, личности сотрудников и корпоративных данных. Мы проводим регулярный анализ данных, выявляем потенциальные угрозы и предоставляем рекомендации по предотвращению компрометации. Такой подход позволяет своевременно реагировать на попытки взлома и сохранить репутацию вашей компании.',
                    'filepath' => 'uploads/services/dark_web_monitoring.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Технические средства безопасности',
                    'price' => 5000,
                    'description' => 'Проектирование, установка и обслуживание современных систем видеонаблюдения, сигнализаций и систем контроля и управления доступом (СКУД). Мы используем интеллектуальные технологии распознавания лиц и анализа поведения, что повышает эффективность охраны и снижает количество ложных срабатываний. Наша цель — обеспечить комплексный технический контроль для максимальной безопасности вашего объекта.',
                    'filepath' => 'uploads/services/security_systems.jpg',
                    'userId' => 1,
                ],
                [
                    'title' => 'Консалтинг по безопасности',
                    'price' => 4500,
                    'description' => 'Проведение специализированных тренингов по безопасности для сотрудников, анализ рисков и разработка индивидуальных стратегий защиты бизнеса. Мы обучаем персонал правильным действиям в чрезвычайных ситуациях, помогаем выявить слабые места в системе безопасности и предлагаем эффективные решения для их устранения. Это помогает минимизировать риски и повысить общий уровень защиты компании.',
                    'filepath' => 'uploads/services/security_consulting.jpg',
                    'userId' => 1,
                ],
            ];

            News::query()->insert($news);
            Service::query()->insert($services);

            return;
        }
    }

    protected function initUserAndGroups() {
        $user = User::query()->find(1);
        $groups = Group::all();

        if($user && count($groups) > 2) {
            return;
        }

        foreach($groups as $group) {
            $group->delete();
        }

        $group = Group::query();

        $group->create([
            'title'      => 'admin',
            'permission' => GroupPremission::ADMIN,
        ]);

        $group->create([
            'title'      => 'moderator',
            'permission' => GroupPremission::MODERATOR,
        ]);

        $group->create([
            'title'      => 'user',
            'permission' => GroupPremission::USER,
        ]);

        if($user) {
            return;
        }

        User::factory()->create([
            'active'       => true,
            'username'     => 'admin',
            'password'     => env('APP_PASSWORD'),
            'groupId'      => 1,
        ]);
    }
}
